═══════════════════════════════════════════════════════════════
            Device Readings Analyzer 使用指南
═══════════════════════════════════════════════════════════════

【程序简介】

本程序是一款专业的设备数码管读数识别工具，采用计算机视觉和PaddleOCR SVTR_Tiny
专用模型技术，能够自动识别七段数码显示器中的数字读数，并将结果导出为Excel表格。
适用于实验室数据采集、工业设备监控、历史数据恢复等场景。

主要特点：
• 支持批量图像处理
• 基于SVTR_Tiny数码管专用深度学习模型（24MB，推理模型优先）
• 无需外部安装，模型已包含在项目中，开箱即用
• 支持负数和小数点识别
• 支持小数点位置调整功能（Keep/None/0.1/0.01/0.001/0.0001）
• 智能数据可视化：根据置信度动态显示不同颜色的散点图
• 交互式图像跳转：点击数据点即可查看对应图像帧
• 一键导出Excel格式（含置信度列）

═══════════════════════════════════════════════════════════════
【使用流程】
═══════════════════════════════════════════════════════════════

第一步：加载图像序列
─────────────────────────────────────────────────────────────

1. 点击菜单栏 File → Load Image Sequence
2. 选择包含设备读数图像的文件夹
3. 支持的图像格式：JPG、PNG、BMP、TIFF
4. 图像要求：
   • 数码管位置在各图像中保持一致
   • 图像清晰，数字可辨认
   • 建议按时间顺序命名文件

提示：程序会自动按文件名排序加载图像。


第二步：选择读数区域（ROI）
─────────────────────────────────────────────────────────────

1. 点击控制面板中的"Select ROI"按钮
2. 程序会自动显示第一张图像
3. 在图像上按住鼠标左键拖动，框选数码显示区域
4. 确保完整包含所有数字（包括小数点和负号）
5. 松开鼠标后，选择的区域会显示绿色边框
6. 如需重新选择，点击"Clear ROI"按钮清除当前选择

注意事项：
• ROI区域应尽量紧凑，只包含数字显示部分
• 避免包含过多背景或其他无关元素
• 确保所有图像中的数码管都在此区域内


第三步：设置参数
─────────────────────────────────────────────────────────────

【时间参数】

• Time Interval（时间间隔）
  - 相邻两张图像之间的时间间隔
  - 输入数值，如：1.0、0.5、10
  
• Time Unit（时间单位）
  - 选择时间单位：毫秒、秒、分钟、小时
  - milliseconds：适合高速采集
  - seconds：最常用
  - minutes/hours：适合长时间监控
  
• Start Time（起始时间）
  - 第一张图像对应的时间点
  - 默认为0，可根据需要设置
  
• Reading Unit（读数单位）
  - 输入读数的物理单位
  - 如：°C、MPa、V、A、rpm等
  - 此单位会显示在图表和导出的Excel文件中

• Decimal Position（小数点位置）
  - 调整识别结果的小数点位置和精度
  - Keep：保持原始识别结果（默认）
  - None：移除小数点，得到整数
  - 0.1：调整为1位小数
  - 0.01：调整为2位小数
  - 0.001：调整为3位小数
  - 0.0001：调整为4位小数
  - 使用场景：数码管不显示小数点，但实际读数需要小数位

【预处理选项】

• Erosion Size（腐蚀运算核大小）
  - 0 表示禁用，>0 表示启用
  - 用于去除噪声和小对象
  - 使用矩形核
  - 推荐值：
    * 轻微噪声：2
    * 中度噪声：3
    * 严重噪声：4
  - 启用后自动处理小数点：
    * 自动检测小数点（面积最小且小于倒数第二小的1/4）
    * 扩展其他对象与小数点的水平间距（4倍腐蚀核大小）
    * 对其他对象进行膨胀，恢复原状
    * 将小数点替换为实心圆点（直径=max(4×腐蚀核, ROI高度/15)）
  
• Closing Size（闭运算核大小）
  - 0 表示禁用，>0 表示启用
  - 修复断裂或不完整的笔画
  - 连接断开的数字部分
  - 使用矩形核，自动保护小数点
  - 推荐值：
    * 轻微断裂：3
    * 中度断裂：5
    * 严重断裂：7
  - 数值越大，连接效果越强，但可能导致过度连接
  
• Preview Preprocessing（预览预处理）
  - 点击此按钮查看当前设置的预处理效果
  - 在新窗口中显示处理后的二值化图像
  - 便于调试和优化参数
  - 按任意键关闭预览窗口


第四步：处理图像
─────────────────────────────────────────────────────────────

1. 确认所有参数设置正确
2. 点击"Process Images"按钮开始批量处理
3. 处理过程中：
   • 图像预览区域会显示当前处理的图像
   • 日志窗口实时显示每张图像的识别结果
   • 图表区域动态更新数据散点图（根据置信度显示不同颜色）
     - 🟢 绿色：高置信度 (≥ 0.9)
     - 🟠 橙色：中等置信度 (0.75 ~ 0.89)
     - 🔴 红色：低置信度 (< 0.75)
     - ⚫ 黑色：识别失败 (NaN)
   • 图像滑块自动移动到当前处理位置
   • 可点击"Stop Processing"按钮随时中止处理
   • 注意：处理期间点击散点图的跳转功能被禁用

4. 日志信息说明：
   • 黑色[INFO]：成功识别
     示例：Image 1: 0.00 seconds → 25.3 °C
   • 橙色[WARNING]：识别失败或无效读数
     示例：Image 5: No valid reading
   • 红色[ERROR]：处理错误
     示例：Recognition error on image 10: ...

5. 处理完成后会显示统计信息
6. 处理完成后可使用交互式跳转功能


第五步：查看和交互（新功能）
─────────────────────────────────────────────────────────────

【置信度可视化】

处理完成后，散点图会用不同颜色表示每个数据点的识别置信度：

• 🟢 绿色点 (置信度 ≥ 0.9)
  - 高置信度识别，结果高度可信
  - 通常无需人工复核
  
• 🟠 橙色点 (置信度 0.75 ~ 0.89)
  - 中等置信度识别，基本可信
  - 建议抽查验证，如有异常值需检查
  
• 🔴 红色点 (置信度 < 0.75)
  - 低置信度识别，可信度较低
  - 强烈建议人工复核对应图像
  
• ⚫ 黑色点 (NaN - 识别失败)
  - 完全无法识别
  - 需要检查原始图像或调整参数

【交互式图像跳转】

1. 点击散点图上的任意数据点
2. 图像预览区域自动跳转到对应图像帧
3. 图像滑块同步更新到对应位置
4. 日志窗口显示跳转信息：
   • 帧号（如：第15帧/共100帧）
   • 时间值（如：14.5 s）
   • 读数值（如：25.3 °C）
   • 置信度（如：0.876）

使用建议：
• 快速质检：点击红色或黑色点快速定位问题图像
• 数据验证：点击橙色点进行抽样复核
• 趋势分析：观察颜色分布了解整体识别质量

注意事项：
• 图像处理过程中点击跳转功能被禁用
• 处理完成后即可使用交互功能


第六步：导出数据
─────────────────────────────────────────────────────────────

1. 处理完成后，菜单栏中的 File → Export to Excel 会变为可用状态
2. 点击 File → Export to Excel
3. 在对话框中选择保存位置和文件名
4. 数据将导出为Excel格式(.xlsx)

导出文件包含：
• 第一列：时间（带单位）
• 第二列：读数（带单位）
• 第三列：置信度（用于质量评估）
• 工作表名称：Device Readings
• 可直接在Excel、Origin等软件中打开分析

═══════════════════════════════════════════════════════════════
【常见问题解答】
═══════════════════════════════════════════════════════════════

Q1: 识别率低，很多图像无法识别怎么办？

A1: 请尝试以下解决方案：
   1. 优化预处理参数
      • 点击"Preview Preprocessing"查看预处理效果
      • 如果数字笔画断裂，设置 Closing Size > 0（如 3、5、7）
      • 如果噪声较多，设置 Erosion Size > 0（如 2、3）
        - 启用后会自动处理小数点，替换为圆点，提高识别率
      • 两者可组合使用
   
   2. 提高图像质量
      • 确保图像清晰，数字可辨
      • 避免模糊、过曝、欠曝
      • 使用更高分辨率的图像
   
   3. 优化ROI选择
      • 确保ROI区域紧凑，只包含数字部分
      • 留出适当边距
      • 避免包含过多背景
   
   4. 改善拍摄条件
      • 使用均匀的光照
      • 避免反光和阴影
      • 保持相机稳定


Q2: 部分图像显示"No valid reading"警告？

A2: 可能的原因和解决方法：
   1. ROI区域问题
      • 检查ROI是否完整包含所有数字
      • 确保小数点和负号也在ROI内
      • 重新选择更合适的ROI区域
   
   2. 图像质量问题
      • 个别图像可能存在反光、阴影或遮挡
      • 检查这些图像的实际质量
      • 如果图像本身就不清晰，无法识别是正常的
   
   3. 数码管位置偏移
      • 确认所有图像中数码管位置一致
      • 如果有位置偏移，需要重新拍摄或裁剪图像
   
   4. 查看日志详细信息
      • 日志中会显示具体的错误原因
      • 根据错误信息进行针对性调整


Q3: 小数点或负号总是识别失败？

A3: 小数点和负号的识别相对困难，请注意：
   1. ROI选择
      • 确保ROI完整包含小数点和负号的位置
      • 留出足够的边距
   
   2. 图像分辨率
      • 小数点可能太小，考虑使用更高分辨率的图像
      • 或者拍摄时更靠近数码管
   
   3. 图像质量
      • 确保小数点和负号清晰可见
      • 避免过度模糊或失焦
   
   4. 预处理调整
      • 负号可能与数字粘连
      • 尝试调整预处理参数
      • 启用 Erosion Size 后，小数点会自动替换为圆点，提高识别率


Q4: 小数点位置不对怎么办？

A4: 使用Decimal Position功能调整：
   1. 问题场景
      • 数码管显示"12345"，但实际读数应为"123.45"
      • 数码管显示"1000"，但实际读数应为"1.000"
   
   2. 解决方案
      • 在Decimal Position下拉框选择目标精度
      • 例如：选择"0.01"表示2位小数
      • 程序自动将识别结果调整为正确精度
   
   3. 使用示例
      • 原始识别结果："12345"
      • 选择精度："0.01"（2位小数）
      • 输出结果："123.45"
   
   4. 其他用途
      • 统一不同图像的小数位数格式
      • 去除小数点（选择"None"）
      • 转换整数为小数（选择目标精度）


Q5: SVTR_Tiny识别失败怎么办？

A5: SVTR_Tiny识别失败时的处理方法：
   1. 检查图像质量
      • 确保数字清晰完整
      • 分辨率足够高（建议ROI高度>32像素）
      • 避免过度模糊或失焦
   
   2. 调整预处理参数
      • 使用"Preview Preprocessing"查看效果
      • 根据数码管特点调整参数
   
   3. 优化ROI区域
      • ROI应紧密包围数字区域
      • 留出10-20像素的边距
   
   4. 改善拍摄条件
      • 使用正面拍摄，避免倾斜
      • 保持稳定，避免运动模糊
   
   5. 检查模型文件
      • 确保./svtr_tiny_digital/目录存在
      • 检查是否有inference.pdmodel和inference.pdiparams文件
      • 或者best_accuracy.pdparams文件
      • 程序自动优先使用推理模型（速度更快）


Q6: 如何提高处理速度？

A6: 处理速度优化建议：
   1. 降低图像分辨率
      • 在保证数字清晰的前提下使用较低分辨率
      • 可以在拍摄或导入前对图像进行缩放
   
   2. 选择更小的ROI区域
      • 只包含数字显示部分，不要有多余背景
   
   3. 关闭不必要的预处理
      • 如果图像质量好，设置 Erosion Size: 0 和 Closing Size: 0
   
   4. 减少图像数量
      • 如果允许，可以降低采样频率


Q7: 导出的Excel文件在哪里？如何使用？

A7: 
   1. 文件位置
      • 在您选择的保存位置
      • 文件名为您指定的名称
   
   2. 文件内容
      • 第一列：时间值（包含单位）
      • 第二列：读数值（包含单位）
      • 每行对应一张图像的识别结果
   
   3. 使用方法
      • 可直接用Excel打开查看和编辑
      • 可导入Origin、MATLAB等进行数据分析
      • 可用于绘制曲线图、计算统计量等


Q8: 程序突然卡住或无响应怎么办？

A8: 
   1. 等待处理完成
      • 大量图像处理需要时间，请耐心等待
      • 可以通过日志窗口查看进度
   
   2. 使用停止功能
      • 点击"Stop Processing"按钮中止处理
      • 已处理的数据会保留
   
   3. 检查图像数量和大小
      • 如果图像数量很大（>1000张）或分辨率很高
      • 考虑分批处理或降低分辨率
   
   4. 重启程序
      • 如果真的无响应，可以关闭程序重新打开


═══════════════════════════════════════════════════════════════
【参数速查表】
═══════════════════════════════════════════════════════════════

┌─────────────────────┬────────────────────────────────┐
│ 使用场景            │ 推荐参数设置                    │
├─────────────────────┼────────────────────────────────┤
│ 标准识别            │ • Erosion Size: 0               │
│ （图像质量好）       │ • Closing Size: 0               │
│                     │ • Decimal Position: Keep        │
│                     │ • ROI紧凑，使用SVTR_Tiny推理模型│
├─────────────────────┼────────────────────────────────┤
│ 低质量图像          │ • Erosion Size: 2               │
│ （模糊、噪点多）     │ • Closing Size: 5               │
│                     │ • Decimal Position: Keep        │
│                     │ • 提高图像分辨率                 │
├─────────────────────┼────────────────────────────────┤
│ 噪声较多            │ • Erosion Size: 2-3             │
│ （背景噪声大）       │ • Closing Size: 0               │
│                     │ • Decimal Position: Keep        │
├─────────────────────┼────────────────────────────────┤
│ 光照不均            │ • Erosion Size: 2               │
│ （过曝/欠曝）        │ • Closing Size: 3               │
│                     │ • Decimal Position: Keep        │
│                     │ • 优化光照条件                   │
├─────────────────────┼────────────────────────────────┤
│ 笔画断裂            │ • Erosion Size: 0               │
│ （显示不完整）       │ • Closing Size: 3-7             │
│                     │ • Decimal Position: Keep        │
│                     │ • Preview调试查看效果            │
├─────────────────────┼────────────────────────────────┤
│ 识别率要求极高      │ • 使用高质量图像                 │
│ （容错率低）         │ • ROI高度>50像素                │
│                     │ • Decimal Position: Keep        │
│                     │ • 优化光照和拍摄角度             │
├─────────────────────┼────────────────────────────────┤
│ 无小数点显示        │ • Erosion Size: 0               │
│ （需要添加小数位）   │ • Closing Size: 0               │
│                     │ • Decimal Position: 0.01/0.001  │
│                     │ • 根据实际需求选择精度           │
└─────────────────────┴────────────────────────────────┘


═══════════════════════════════════════════════════════════════
【技术说明】
═══════════════════════════════════════════════════════════════

【识别原理】

本程序采用计算机视觉和PaddleOCR技术识别七段数码管显示：

1. 图像预处理
   • 灰度化：将彩色图像转换为灰度图
   • 二值化：使用Otsu自适应阈值分割
   • 小对象过滤：根据尺寸过滤噪声
   • 边界添加：增加边距（15像素）以提高识别率
   • 可选：腐蚀运算（矩形核）
     - 如果启用且检测到小数点：
       * 检测小数点（面积最小且小于倒数第二小的1/4）
       * 扩展其他对象与小数点的水平间距（4倍腐蚀核大小）
       * 对其他对象进行膨胀，恢复原状
       * 将小数点替换为实心圆点（直径=max(4×腐蚀核, ROI高度/15)）
   • 可选：闭运算（矩形核，保护小数点）
   • 尺寸调整：确保图像尺寸适合OCR识别

2. SVTR_Tiny 数码管专用识别
   • 深度学习模型：基于SVTR_Tiny的数码管专用模型
   • 推理模型优先：inference.pdmodel + inference.pdiparams（24MB，速度更快）
   • 训练模型备用：best_accuracy.pdparams（备用支持）
   • 自定义字典：仅包含0-9、-、.共12个字符
   • 字符白名单：仅识别"-0123456789."
   • 置信度过滤：自动过滤低置信度结果
   • 智能文字识别：自动检测和识别数字
   • 模型管理：模型已包含在项目中（./svtr_tiny_digital/），开箱即用

3. 结果验证
   • 格式检查：验证是否符合数字格式
   • 字符过滤：移除非法字符
   • 置信度筛选：只保留高质量结果

【支持的数码管类型】

• 七段LED数码管（最常见）
  - 红色、绿色、蓝色等各种颜色
  - 共阳极或共阴极均可
  
• 液晶数字显示器（LCD）
  - 黑底白字
  - 白底黑字
  
• 其他点阵式数字显示
  - 需要数字形状接近标准七段显示


【技术限制】

1. 要求数码管位置固定
   • 所有图像中数码管必须在相同位置
   • 如果位置变化，需要每张图像单独选择ROI
   
2. 要求图像质量足够
   • 数字必须清晰可辨
   • 过度模糊或损坏的图像无法识别
   
3. 只支持七段数码显示
   • 不支持手写数字
   • 不支持印刷体数字
   • 不支持其他非标准字体


═══════════════════════════════════════════════════════════════
【作者与版权信息】
═══════════════════════════════════════════════════════════════

程序名称：Device Readings Analyzer
版本号：4.0.2
开发日期：2025-11-22

作者：Lucien
邮箱：lucien-6@qq.com

许可证：MIT License
版权所有 © 2025 Lucien

Permission is hereby granted, free of charge, to any person 
obtaining a copy of this software and associated documentation 
files (the "Software"), to deal in the Software without 
restriction, including without limitation the rights to use, 
copy, modify, merge, publish, distribute, sublicense, and/or 
sell copies of the Software, subject to the following conditions:

The above copyright notice and this permission notice shall be 
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.


═══════════════════════════════════════════════════════════════
            感谢使用 Device Readings Analyzer！
                      
            如有问题或建议，欢迎联系：
                  lucien-6@qq.com
═══════════════════════════════════════════════════════════════

